<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>Angr basic - Frost's blog</title><meta name=Description content><meta property="og:title" content="Angr basic"><meta property="og:description" content="Tuáº§n nÃ y mÃ¬nh sáº½ báº¯t Ä‘áº§u há»c vá» Angr, viá»‡c mÃ  Ä‘Ã¡ng láº½ pháº£i lÃ m tá»« tuáº§n trÆ°á»›c ğŸ™‚ . Má»¥c tiÃªu láº§n nÃ y lÃ  trong 3 ngÃ y pháº£i nhá»› Ä‘Æ°á»£c má»™t sá»‘ lá»‡nh vÃ  dÃ¹ng Angr Ä‘á»ƒ giáº£i Ä‘Æ°á»£c vÃ i bÃ i trong (https://github.com/jakespringer/angr_ctf). Tá»‘n máº¥t 1 tuáº§n há»c hÃ nh khÃ´ng hiá»‡u quáº£ rá»“i, cháº¥n chá»‰nh láº¡i nÃ o!
Top Level Interfaces Sáºµn cÃ³ angr_ctf, mÃ¬nh sáº½ láº¥y bÃ i â€œ00_angr_findâ€ Ä‘á»ƒ lÃ m vÃ­ dá»¥ luÃ´n."><meta property="og:type" content="article"><meta property="og:url" content="/posts/old_posts/2020-07-07-angr-basic/"><meta property="og:image" content="/images/slime-attack.gif"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-07-07T00:00:00+00:00"><meta property="article:modified_time" content="2020-07-07T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/images/slime-attack.gif"><meta name=twitter:title content="Angr basic"><meta name=twitter:description content="Tuáº§n nÃ y mÃ¬nh sáº½ báº¯t Ä‘áº§u há»c vá» Angr, viá»‡c mÃ  Ä‘Ã¡ng láº½ pháº£i lÃ m tá»« tuáº§n trÆ°á»›c ğŸ™‚ . Má»¥c tiÃªu láº§n nÃ y lÃ  trong 3 ngÃ y pháº£i nhá»› Ä‘Æ°á»£c má»™t sá»‘ lá»‡nh vÃ  dÃ¹ng Angr Ä‘á»ƒ giáº£i Ä‘Æ°á»£c vÃ i bÃ i trong (https://github.com/jakespringer/angr_ctf). Tá»‘n máº¥t 1 tuáº§n há»c hÃ nh khÃ´ng hiá»‡u quáº£ rá»“i, cháº¥n chá»‰nh láº¡i nÃ o!
Top Level Interfaces Sáºµn cÃ³ angr_ctf, mÃ¬nh sáº½ láº¥y bÃ i â€œ00_angr_findâ€ Ä‘á»ƒ lÃ m vÃ­ dá»¥ luÃ´n."><meta name=application-name content="LoveIt"><meta name=apple-mobile-web-app-title content="LoveIt"><link rel="shortcut icon" type=image/x-icon href=../../../favicon.ico><link rel=icon type=image/png sizes=32x32 href=../../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../../favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=../../../apple-touch-icon.png><link rel=manifest href=../../../site.webmanifest><link rel=canonical href=../../../posts/old_posts/2020-07-07-angr-basic/><link rel=prev href=../../../posts/old_posts/2020-07-07-angr-ctf/><link rel=next href=../../../posts/old_posts/2020-07-07-angstrom-2020/><link rel=stylesheet href=../../../lib/normalize/normalize.min.css><link rel=stylesheet href=../../../css/style.min.css><link rel=stylesheet href=../../../lib/fontawesome-free/all.min.css><link rel=stylesheet href=../../../lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Angr basic","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"\/posts\/old_posts\/2020-07-07-angr-basic\/"},"genre":"posts","keywords":"learning","wordcount":1178,"url":"\/posts\/old_posts\/2020-07-07-angr-basic\/","datePublished":"2020-07-07T00:00:00+00:00","dateModified":"2020-07-07T00:00:00+00:00","publisher":{"@type":"Organization","name":"Frost"},"author":{"@type":"Person","name":"Frost"},"description":""}</script></head><body header-desktop header-mobile><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"dark"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"dark"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=../../../ title="Frost's blog"><img class="lazyload logo" src=../../../svg/loading.min.svg data-src=../../../images/slime-attack.gif data-srcset="../../../images/slime-attack.gif, ../../../images/slime-attack.gif 1.5x, ../../../images/slime-attack.gif 2x" data-sizes=auto alt=/images/slime-attack.gif title=/images/slime-attack.gif></a></div><div class=menu><div class=menu-inner><a class=menu-item href=../../../posts/>Posts </a><a class=menu-item href=../../../tags/>Tags </a><a class=menu-item href=../../../about/>About </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=../../../ title="Frost's blog"><img class="lazyload logo" src=../../../svg/loading.min.svg data-src=../../../images/slime-attack.gif data-srcset="../../../images/slime-attack.gif, ../../../images/slime-attack.gif 1.5x, ../../../images/slime-attack.gif 2x" data-sizes=auto alt=/images/slime-attack.gif title=/images/slime-attack.gif></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=../../../posts/ title>Posts</a><a class=menu-item href=../../../tags/ title>Tags</a><a class=menu-item href=../../../about/ title>About</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">Angr basic</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=../../../ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>Frost</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2020-07-07>2020-07-07</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1178 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;6 minutes&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#top-level-interfaces>Top Level Interfaces</a></li><li><a href=#loader>Loader</a></li><li><a href=#the-factory>The factory</a><ul><li></li><li><a href=#symbolic-execution>Symbolic Execution</a></li></ul></li></ul></nav></div></div><div class=content id=content><p>Tuáº§n nÃ y mÃ¬nh sáº½ báº¯t Ä‘áº§u há»c vá» Angr, viá»‡c mÃ  Ä‘Ã¡ng láº½ pháº£i lÃ m tá»« tuáº§n trÆ°á»›c ğŸ™‚ . Má»¥c tiÃªu láº§n nÃ y lÃ  trong 3 ngÃ y pháº£i nhá»› Ä‘Æ°á»£c má»™t sá»‘ lá»‡nh vÃ  dÃ¹ng Angr Ä‘á»ƒ giáº£i Ä‘Æ°á»£c vÃ i bÃ i trong (<a href=https://github.com/jakespringer/angr_ctf%29 target=_blank rel="noopener noreffer">https://github.com/jakespringer/angr_ctf)</a>. Tá»‘n máº¥t 1 tuáº§n há»c hÃ nh khÃ´ng hiá»‡u quáº£ rá»“i, cháº¥n chá»‰nh láº¡i nÃ o!</p><h2 id=top-level-interfaces>Top Level Interfaces</h2><p>Sáºµn cÃ³ angr_ctf, mÃ¬nh sáº½ láº¥y bÃ i â€œ00_angr_findâ€ Ä‘á»ƒ lÃ m vÃ­ dá»¥ luÃ´n.
Ta dÃ¹ng lá»‡nh Project Ä‘á»ƒ load binary nÃ y:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>angr</span>
</span></span><span class=line><span class=cl><span class=n>proj</span><span class=o>=</span><span class=n>angr</span><span class=o>.</span><span class=n>Project</span><span class=p>(</span><span class=s2>&#34;./00_angr_find&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Lá»‡nh Project á»Ÿ trÃªn sáº½ tá»± Ä‘á»™ng load luÃ´n cáº£ cÃ¡c thÆ° viá»‡n Ä‘Æ°á»£c link vá»›i binary, náº¿u khÃ´ng muá»‘n Ä‘iá»u nÃ y xáº£y ra thÃ¬ ta cÃ³ thá»ƒ dÃ¹ng</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>proj</span><span class=o>=</span><span class=n>angr</span><span class=o>.</span><span class=n>Project</span><span class=p>(</span><span class=s2>&#34;./00_angr_find&#34;</span><span class=p>,</span><span class=n>auto_load_libs</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Trong document cÃ³ chá»‰ má»™t sá»‘ lá»‡nh cÆ¡ báº£n, sáºµn tiá»‡n nghÃ­a qua chÃºt luÃ´n ğŸ˜€</p><p><img class=lazyload src=../../../svg/loading.min.svg data-src=../assets/img/angr_basic/angr_basic1.png data-srcset="../assets/img/angr_basic/angr_basic1.png, ../assets/img/angr_basic/angr_basic1.png 1.5x, ../assets/img/angr_basic/angr_basic1.png 2x" data-sizes=auto alt=../assets/img/angr_basic/angr_basic1.png title=../assets/img/angr_basic/angr_basic1.png></p><p>3 lá»‡nh trÃªn khÃ¡ dá»… hiá»ƒu, chÃºng láº§n lÆ°á»£t dÃ¹ng Ä‘á»ƒ xem arch, entry point vÃ  tÃªn cá»§a binary (Note: LE trong hÃ¬nh lÃ  Little Edian).</p><hr><h2 id=loader>Loader</h2><p>Loader cá»§a Angr cÃ³ chá»©c nÄƒng lÃ  load binary vÃ o vÃ¹ng Ä‘á»‹a chá»‰ áº£o</p><p><img class=lazyload src=../../../svg/loading.min.svg data-src=../assets/img/angr_basic/angr_basic2.png data-srcset="../assets/img/angr_basic/angr_basic2.png, ../assets/img/angr_basic/angr_basic2.png 1.5x, ../assets/img/angr_basic/angr_basic2.png 2x" data-sizes=auto alt=../assets/img/angr_basic/angr_basic2.png title=../assets/img/angr_basic/angr_basic2.png></p><p>Ta cÅ©ng cÃ³ thá»ƒ dÃ¹ng â€œshared_objectsâ€ vÃ  â€œmain_objectâ€ Ä‘á»ƒ xem má»™t sá»‘ thÃ´ng tin cá»§a cÃ¡c thÆ° viá»‡n vÃ  binary â€œchÃ­nhâ€ mÃ  Angr load vÃ o</p><p><img class=lazyload src=../../../svg/loading.min.svg data-src=../assets/img/angr_basic/angr_basic3.png data-srcset="../assets/img/angr_basic/angr_basic3.png, ../assets/img/angr_basic/angr_basic3.png 1.5x, ../assets/img/angr_basic/angr_basic3.png 2x" data-sizes=auto alt=../assets/img/angr_basic/angr_basic3.png title=../assets/img/angr_basic/angr_basic3.png></p><p>Trong document cÃ³ hÆ°á»›ng dáº«n má»™t sá»‘ lá»‡nh khÃ¡c nhÆ°:</p><ul><li>â€œproj.loader.min_addrâ€ vÃ  â€œproj.loader.max_addrâ€ dÃ¹ng Ä‘á»ƒ xem Ä‘á»‹a chá»‰ cao nháº¥t vÃ  tháº¥p nháº¥t.</li><li>proj.main_object.execstack : kiá»ƒm tra xem bit nx cÃ³ Ä‘Æ°á»£c báº­t khÃ´ng.</li><li>proj.main_object.pic : kiá»ƒm tra xem binary cÃ³ pháº£i lÃ  position independent code (PIC) hay khÃ´ng.</li></ul><hr><h2 id=the-factory>The factory</h2><p>ÄÃ¢y lÃ  chá»— táº­p há»£p cÃ¡c object thÆ°á»ng dÃ¹ng cá»§a Angr, vÃ­ dá»¥ nhÆ° lÃ </p><h4 id=blocks>Blocks</h4><p>Block lÃ  táº­p há»£p cÃ¡c cÃ¢u lá»‡nh Ä‘Æ°á»£c thá»±c hiá»‡n tuáº§n tá»±, khÃ´ng ráº½ nhÃ¡nh. Äá»ƒ dá»… hÃ¬nh dung hÆ¡n thÃ¬ trong IDA, má»™t khá»‘i nhÆ° nÃ y chá»©a má»™t block.</p><p><img class=lazyload src=../../../svg/loading.min.svg data-src=../assets/img/angr_basic/angr_basic4.png data-srcset="../assets/img/angr_basic/angr_basic4.png, ../assets/img/angr_basic/angr_basic4.png 1.5x, ../assets/img/angr_basic/angr_basic4.png 2x" data-sizes=auto alt=../assets/img/angr_basic/angr_basic4.png title=../assets/img/angr_basic/angr_basic4.png></p><p>Äá»ƒ cÃ³ má»™t block táº¡i má»™t Ä‘á»‹a chá»‰ nÃ o Ä‘Ã³ (giáº£ sá»­ lÃ  á»Ÿ entry point Ä‘i), ta dÃ¹ng:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>proj</span><span class=o>.</span><span class=n>factory</span><span class=o>.</span><span class=n>block</span><span class=p>(</span><span class=n>proj</span><span class=o>.</span><span class=n>entry</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>CÃ¢u lá»‡nh trÃªn sáº½ tráº£ vá» má»™t Block object, mang nhá»¯ng thÃ´ng tin vá» block táº¡i Ä‘á»‹a chá»‰ mong muá»‘n. Ta cÃ³ thá»ƒ lÆ°u object nÃ y vÃ o biáº¿n vÃ  sá»­ dá»¥ng nhá»¯ng lá»‡nh khÃ¡c Ä‘á»ƒ phÃ¢n tÃ­ch tiáº¿p</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>block</span> <span class=o>=</span> <span class=n>proj</span><span class=o>.</span><span class=n>factory</span><span class=o>.</span><span class=n>block</span><span class=p>(</span><span class=n>proj</span><span class=o>.</span><span class=n>entry</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>block</span><span class=o>.</span><span class=n>pp</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>block</span><span class=o>.</span><span class=n>instructions</span>
</span></span><span class=line><span class=cl><span class=n>block</span><span class=o>.</span><span class=n>instruction_addrs</span>
</span></span></code></pre></td></tr></table></div></div><p>CÃ¡c cÃ¢u lá»‡nh trÃªn láº§n lÆ°á»£t lÃ :
- block.pp() : DÃ¹ng Ä‘á»ƒ in cÃ¡c cÃ¢u lá»‡nh assembly cá»§a block ra stdout (Note: pp lÃ  viáº¿t táº¯t cá»§a pretty-print)
- block.instructions: tráº£ vá» sá»‘ cÃ¢u lá»‡nh trong block.
- block.instruction_addrs: tráº£ vá» má»™t array chá»©a Ä‘á»‹a chá»‰ cá»§a cÃ¡c cÃ¢u lá»‡nh trong block.</p><h4 id=states>States</h4><p>MÃ¬nh thá»±c sá»± khÃ´ng biáº¿t giáº£i thÃ­ch cÃ¡i state nÃ y nhÆ° tháº¿ nÃ o. Theo mÃ¬nh hiá»ƒu, khi dÃ¹ng Angr execute má»™t binary thÃ¬ Angr sáº½ khi láº¡i cÃ¡c â€œtráº¡ng thÃ¡iâ€ cá»§a binary Ä‘Ã³ lÃºc cháº¡y (bao gá»“m giÃ¡ trá»‹ trong cÃ¡c thanh ghi vÃ  bá»™ nhá»›,â€¦). Má»—i â€œtráº¡ng thÃ¡iâ€ nhÆ° tháº¿ Ä‘Æ°á»£c thá»ƒ hiá»‡n báº±ng má»™t object gá»i lÃ  SimState</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>state</span> <span class=o>=</span> <span class=n>proj</span><span class=o>.</span><span class=n>factory</span><span class=o>.</span><span class=n>entry_state</span><span class=p>(</span><span class=n>addr</span><span class=o>=&lt;</span><span class=n>address</span><span class=o>&gt;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>CÃ¢u lá»‡nh trÃªn cho ta má»™t SimState trong biáº¿n state, vá»›i giÃ¡ trá»‹ trong thanh ghi RIP lÃ  (tá»©c lÃ  cÃ¢u lá»‡nh Ä‘Æ°á»£c thá»±c hiá»‡n tiáº¿p theo náº±m á»Ÿ ). Ta tiáº¿p tá»¥c phÃ¢n tÃ­ch SimState:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>state</span><span class=o>.</span><span class=n>regs</span><span class=o>.</span><span class=n>rip</span> <span class=c1># láº¥y giÃ¡ trá»‹ trong thanh ghi rip</span>
</span></span><span class=line><span class=cl><span class=n>state</span><span class=o>.</span><span class=n>regs</span><span class=o>.</span><span class=n>rax</span> <span class=c1># láº¥y giÃ¡ trá»‹ trong thanh ghi eax</span>
</span></span><span class=line><span class=cl><span class=n>state</span><span class=o>.</span><span class=n>mem</span><span class=p>[</span><span class=o>&lt;</span><span class=n>addr</span><span class=o>&gt;</span><span class=p>]</span><span class=o>.&lt;</span><span class=nb>type</span><span class=o>&gt;.</span><span class=n>resolved</span> <span class=c1># truy xuáº¥t giÃ¡ trá»‹ táº¡i Ã´ nhá»› &lt;addr&gt; theo kiá»ƒu &lt;type&gt; trong C</span>
</span></span></code></pre></td></tr></table></div></div><p>Note: VÃ­ dá»¥ cho cÃ¢u lá»‡nh state.mem[]..resolved
â€“ state.mem[0x1000].char.resolved : tráº£ vá» giÃ¡ trá»‹ táº¡i Ä‘á»‹a chá»‰ 0x1000, Ä‘á»c theo quy táº¯c cá»§a kiá»ƒu char (tá»©c lÃ  Ä‘á»c 1 byte)
â€“ state.mem[0x1000].int.resolved : tráº£ vá» giÃ¡ trá»‹ táº¡i 0x1000, Ä‘á»c giá»‘ng nhÆ° kiá»ƒu int (Ä‘á»c 4 byte)</p><p><strong>Note</strong>: GiÃ¡ trá»‹ tráº£ vá» cá»§a cÃ¡c cÃ¢u lá»‡nh á»Ÿ trÃªn thuá»™c kiá»ƒu bitvector. Bitvector lÃ  má»™t dÃ£y bit, Ä‘Æ°á»£c thá»ƒ hiá»‡n dÆ°á»›i dáº¡ng sá»‘ nguyÃªn Ä‘á»ƒ tiá»‡n cho tÃ­nh toÃ¡n.Theo document, bitvector má»™t kiá»ƒu dá»¯ liá»‡u mÃ  Angr dÃ¹ng Ä‘á»ƒ biá»ƒu diá»…n thÃ´ng tin trong bá»™ nhá»›. (not sure)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>state</span><span class=o>.</span><span class=n>solver</span><span class=o>.</span><span class=n>BVV</span><span class=p>(</span><span class=o>&lt;</span><span class=n>value</span><span class=o>&lt;</span><span class=nb>len</span><span class=o>&gt;</span><span class=p>)</span> <span class=c1>#Ä‘á»•i giÃ¡ trá»‹ &lt;value&gt; sang bitvector cÃ³ Ä‘á»™ dÃ i &lt;len&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>state</span><span class=o>.</span><span class=n>solver</span><span class=o>.</span><span class=n>eval</span><span class=p>(</span><span class=n>bv</span><span class=p>)</span> <span class=c1>#Ä‘á»•i bitvector vá» láº¡i kiá»ƒu int trong python</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>state</span><span class=o>.</span><span class=n>mem</span><span class=p>[</span><span class=o>&lt;</span><span class=n>addr</span><span class=o>&gt;</span><span class=p>]</span><span class=o>.&lt;</span><span class=nb>type</span><span class=o>&gt;.</span><span class=n>concrete</span> <span class=c1># tÆ°Æ¡ng tá»± nhÆ° .resolved á»Ÿ trÃªn nhÆ°ng sáº½ tráº£ vá» giÃ¡ trá»‹ kiá»ƒu int trong python</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Note2</strong>: CÃ³ 2 cÃ¢u lá»‡nh cÅ©ng thÆ°á»ng Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ load vÃ  store dá»¯ liá»‡u vÃ o Ã´ nhá»›</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>state</span><span class=o>.</span><span class=n>memory</span><span class=o>.</span><span class=n>store</span><span class=p>(</span><span class=o>&lt;</span><span class=n>address</span><span class=o>&gt;</span><span class=p>,</span><span class=o>&lt;</span><span class=n>datacÃ³</span> <span class=n>thá»ƒ</span> <span class=n>lÃ </span> <span class=nb>int</span><span class=p>,</span> <span class=n>bitvector</span><span class=p>,</span><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=n>state</span><span class=o>.</span><span class=n>memory</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=o>&lt;</span><span class=n>address</span><span class=o>&gt;</span><span class=p>,</span><span class=o>&lt;</span><span class=n>lengthh</span> <span class=n>lÃ </span> <span class=n>sá»‘</span> <span class=n>byte</span> <span class=n>cáº§n</span> <span class=n>Ä‘á»c</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=simulation-managers>Simulation Managers</h4><p>Vá»›i SimState, ta cÃ³ thá»ƒ phÃ¢n tÃ­ch â€œtráº¡ng thÃ¡iâ€ cá»§a binary táº¡i má»™t thá»i Ä‘iá»ƒm nháº¥t Ä‘á»‹nh. VÃ  náº¿u muá»‘n nháº£y tá»« state nÃ y sang state khÃ¡c (giá»‘ng kiá»ƒu execute cÃ¡i binary ) thÃ¬ ta sáº½ dÃ¹ng Ä‘áº¿n Simulation Managers</p><p>Táº¡o 1 Simulation Managers:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>simgr</span> <span class=o>=</span> <span class=n>proj</span><span class=o>.</span><span class=n>factory</span><span class=o>.</span><span class=n>simulation_manager</span><span class=p>(</span><span class=n>state</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Ta vá»«a Ä‘Æ°a má»™t state vÃ o trong simulation_manager, khi Ä‘Ã³ â€œsimgr.active[0]â€ chÃ­nh lÃ  cÃ¡i state mÃ  chÃºng ta Ä‘Ã£ Ä‘Æ°a vÃ o. Váº­y tá»©c lÃ  ta cÃ³ thá»ƒ coi â€œsimgr.active[0]â€ nhÆ° má»™t state</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>simgr</span><span class=o>.</span><span class=n>active</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>mem</span><span class=p>[</span><span class=mh>0x1021ab0</span><span class=p>]</span><span class=o>.</span><span class=n>int</span><span class=o>.</span><span class=n>concrete</span> 
</span></span><span class=line><span class=cl><span class=n>simgr</span><span class=o>.</span><span class=n>active</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>regs</span><span class=o>.</span><span class=n>rpi</span>
</span></span></code></pre></td></tr></table></div></div><p>Tiáº¿p theo, Ä‘á»ƒ execute, ta sáº½ dÃ¹ng</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>simgr</span><span class=o>.</span><span class=n>step</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>Lá»‡nh nÃ y tÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i viá»‡c execute má»™t block. LÆ°u Ã½ lÃ  step() sáº½ khÃ´ng lÃ m thay Ä‘á»•i biáº¿n state, nÃ³ chá»‰ thay Ä‘á»•i â€œsimgr.active[0]â€ mÃ  thÃ´i.</p><h3 id=symbolic-execution>Symbolic Execution</h3><p>CÃ¡i nÃ y lÃ  má»¥c tiÃªu khi há»c Angr Ä‘Ã¢y ğŸ™‚</p><p>Symbolic Execution lÃ  cÃ¡ch kháº£o sÃ¡t toÃ n bá»™ cÃ¡c â€œÄ‘Æ°á»ng Ä‘iâ€ cÃ³ thá»ƒ cÃ³ khi cháº¡y chÆ°Æ¡ng trÃ¬nh. Giáº£ sá»­ ta cÃ³ Ä‘oáº¡n chÆ°Æ¡ng trÃ¬nh sau:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>num</span><span class=o>=</span><span class=nb>input</span><span class=p>(</span><span class=s2>&#34;Enter number: &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>num</span><span class=o>==</span><span class=mi>4</span><span class=p>:</span>
</span></span><span class=line><span class=cl>   <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Good&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>   <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;I don&#39;t feel so good&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>ChÆ°Æ¡ng trÃ¬nh trÃªn cÃ³ thá»ƒ thá»±c thi theo 2 hÆ°á»›ng: má»™t hÆ°á»›ng in ra â€œGoodâ€ (khi num==4) vÃ  hÆ°á»›ng cÃ²n láº¡i lÃ  in ra â€ I donâ€™t feel so goodâ€. Vá»›i Symbolic Execution, ta sáº½ kháº£o sÃ¡t cáº£ 2 hÆ°á»›ng nÃ y.</p><p>Ok, váº­y giáº£ sá»­ ta muá»‘n Ä‘áº¿n Ä‘Æ°á»£c dÃ²ng print(â€œGoodâ€), tá»©c lÃ  muá»‘n tÃ¬m xem input nhÆ° tháº¿ nÃ o thÃ¬ chÆ°Æ¡ng trÃ¬nh in ra chá»¯ â€œGoodâ€. Symbolic Execution sáº½ giÃºp ta thá»±c hiá»‡n viá»‡c nÃ y dá»… dÃ ng hÆ¡n, thÃ´ng qua cÃ¡c bÆ°á»›c sau:</p><ul><li><strong>Step 1: Inject a Symbol</strong><br>Symbol á»Ÿ Ä‘Ã¢y chÃ­nh lÃ  Symbolic variable Ä‘Æ°á»£c nÃ³i Ä‘áº¿n á»Ÿ trÃªn. ChÃºng lÃ  cÃ¡c biáº¿n mÃ  ta khÃ´ng biáº¿t giÃ¡ trá»‹, tuy nhiÃªn cÃ³ thá»ƒ tÃ¬m Ä‘Æ°á»£c giÃ¡ trá»‹ thÃ´ng qua cÃ¡c constraints (rÃ ng buá»™c).</li><li><strong>Step 2: Branch (ráº½ nhÃ¡nh)</strong><br>Branch á»Ÿ Ä‘Ã¢y tá»©c lÃ  ráº½ ra cÃ¡c hÆ°á»›ng thá»±c thi (execution path) khÃ¡c nhau. NhÆ° trong vÃ­ dá»¥ trÃªn, Ä‘áº¿n cÃ¢u lá»‡nh if, ta sáº½ ráº½ ra 2 nhÃ¡nh lÃ : <em>num == 4</em> vÃ  <em>num != 4</em></li><li><strong>Step 3: Evaluate each Branch</strong><br>Äáº¿n bÆ°á»›c nÃ y, chÃºng ta sáº½ phÃ¢n tÃ­ch tá»«ng nhÃ¡nh má»™t. Náº¿u gáº·p nhÃ¡nh khÃ´ng há»£p yÃªu cáº§u (khÃ´ng Ä‘áº¿n Ä‘Æ°á»£c lá»‡nh <em>print (â€œGoodâ€)</em>), thÃ¬ ta sáº½ bá» nhÃ¡nh Ä‘Ã³ vÃ  xÃ©t má»™t nhÃ¡nh má»›i.<br>Khi tÃ¬m Ä‘Æ°á»£c nhÃ¡nh Ä‘áº¡t yÃªu cáº§u, ta cÅ©ng sáº½ cÃ³ Ä‘Æ°á»£c nhá»¯ng constraint cho symbol. NhÆ° trong vd trÃªn, Ä‘á»ƒ Ä‘áº¿n Ä‘Æ°á»£c <em>print(â€œGoodâ€)</em>, ta pháº£i cÃ³ Ä‘iá»u kiá»‡n <em>num==4</em>. Váº­y tá»« constraint nÃ y ta cÃ³ thá»ƒ suy ra Ä‘Æ°á»£c input.</li></ul><p>Angr sáº½ giÃºp ta thá»±c hiá»‡n cÃ¡c bÆ°á»›c trÃªn nhanh vÃ  dá»… dÃ ng hÆ¡n. Ok, váº­y giá» lÃ´i Angr_ctf ra giáº£i Ä‘á»ƒ biáº¿t cÃ¡ch dÃ¹ng thÃ´i</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2020-07-07</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=../../../tags/learning/>learning</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=../../../>Home</a></span></section></div><div class=post-nav><a href=../../../posts/old_posts/2020-07-07-angr-ctf/ class=prev rel=prev title=Angr_CTF><i class="fas fa-angle-left fa-fw"></i>Angr_CTF</a>
<a href=../../../posts/old_posts/2020-07-07-angstrom-2020/ class=next rel=next title="A week with Angstromctf 2020">A week with Angstromctf 2020<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.99.0">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=../../../ target=_blank>Frost</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><script type=text/javascript src=../../../lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=../../../lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=../../../lib/clipboard/clipboard.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:100},comment:{}}</script><script type=text/javascript src=../../../js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-CY316V8Z0V")</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-CY316V8Z0V" async></script></body></html>